{% extends "base.html" %}

{% block page_title %}Edit Layout: {{ deck.name }}{% endblock %}

{% block content %}
<div class="add-deck-container">
    <!-- This hidden div will hold the sample card data for the JS preview -->
    <div id="sampleCardData" data-card='{{ sample_card_json }}' style="display: none;"></div>

    <!-- Left Column: Form -->
    <div class="form-column">
        <div class="card form-card">
            <h3>Edit Deck Layout</h3>
            {% if message %}
                <p class="message" style="background-color: #dff0d8; color: #3c763d;">{{ message }}</p>
            {% endif %}
            {% if error %}
                <p class="message" style="background-color: #f2dede; color: #a94442;">{{ error }}</p>
            {% endif %}

            <form action="/decks/{{ deck.id }}/edit_layout" method="post">
                <div class="form-group">
                    <label for="name">Deck Name:</label>
                    <input type="text" id="name" name="name" value="{{ deck.name }}" autocomplete="off" disabled>
                    <small>Deck name can be changed in the deck's settings page.</small>
                </div>

                <div class="form-group">
                    <label for="media_folder">Media Folder Name (Read-only):</label>
                    <input type="text" id="media_folder" name="media_folder" value="{{ deck.media_folder or '' }}" autocomplete="off" disabled>
                    <small style="display: block; margin-top: 5px;">
                        The media folder can be changed in the deck's settings page.
                    </small>
                </div>
                
                <div class="form-group">
                    <label for="card_template">Card Template (Jinja2 HTML):</label>
                    <textarea id="card_template" name="card_template" rows="14" style="width: 100%; font-family: monospace; padding: 5px;" required>{{ deck.card_template }}</textarea>
                    <small style="display: block;">
                        Use `{% raw %}{{ card.data.key }}{% endraw %}` to access card data and `{% raw %}{{ deck.media_folder }}{% endraw %}` for the media folder.
                    </small>
                </div>

                <div class="form-group">
                    <label for="card_css">Card CSS:</label>
                    <textarea id="card_css" name="card_css" rows="10" style="width: 100%; font-family: monospace; padding: 5px;" required>{{ deck.card_css }}</textarea>
                </div>
                
                <button type="submit" class="btn btn-primary">Update Layout</button>
                <a href="/decks" class="btn btn-secondary">Back to Decks</a>
            </form>
        </div>
    </div>

    <!-- Right Column: Live Preview -->
    <div class="preview-column">
        <div class="card">            
             <h3 style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                <span>Card Preview</span>
                <button type="button" id="refreshPreviewBtn" title="Refresh Preview" class="btn btn-secondary" style="padding: 5px 10px; background-color: inherit; color: #95a5a6;"><i class="fas fa-redo"></i></button>
            </h3>
            <div id="card-preview-area" class="card-preview-placeholder">
                <p>Click the refresh button to generate a preview of your card.</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}